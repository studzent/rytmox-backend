-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸš€ ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ˜ Ğ‘Ğ”: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 
-- ğŸ“‹ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:
--    ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ:
--    1. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ users
--    2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ»ÑĞ´
--
-- âœ… Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ:
--    â€¢ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ IF NOT EXISTS - Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
--    â€¢ ĞĞµ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ Ğ¸ Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
--
-- ğŸ“ Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:
--    1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Supabase Dashboard â†’ SQL Editor
--    2. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ²ĞµÑÑŒ ÑÑ‚Ğ¾Ñ‚ Ñ„Ğ°Ğ¹Ğ» (Ctrl+A / Cmd+A)
--    3. Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² SQL Editor (Ctrl+V / Cmd+V)
--    4. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Run (Ğ¸Ğ»Ğ¸ Ctrl+Enter / Cmd+Enter)
--
-- âš¡ ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- ============================================================================
-- ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ 004: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹
-- ============================================================================

-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ users (ĞµÑĞ»Ğ¸ Ğ¸Ñ… ĞµÑ‰Ğµ Ğ½ĞµÑ‚)
DO $$ 
BEGIN
    -- Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'activity_level') THEN
        ALTER TABLE users ADD COLUMN activity_level TEXT;
    END IF;

    -- BMR (Basal Metabolic Rate)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'bmr') THEN
        ALTER TABLE users ADD COLUMN bmr DECIMAL(10, 2);
    END IF;

    -- TDEE (Total Daily Energy Expenditure)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'tdee') THEN
        ALTER TABLE users ADD COLUMN tdee DECIMAL(10, 2);
    END IF;

    -- Ğ¦ĞµĞ»ĞµĞ²Ñ‹Ğµ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'calorie_goal') THEN
        ALTER TABLE users ADD COLUMN calorie_goal INTEGER;
    END IF;
END $$;

-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ CHECK constraint Ğ´Ğ»Ñ activity_level Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ (Ğ´Ğ»Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
DO $$
BEGIN
    -- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ»Ğ¸ ÑƒĞ¶Ğµ constraint
    IF NOT EXISTS (
        SELECT 1 FROM pg_constraint 
        WHERE conname = 'users_activity_level_check'
    ) THEN
        ALTER TABLE users ADD CONSTRAINT users_activity_level_check 
            CHECK (activity_level IS NULL OR activity_level IN ('sedentary', 'light', 'moderate', 'high', 'very_high'));
    END IF;
END $$;

-- ============================================================================
-- ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ¯ 005: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ
-- ============================================================================

-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ
CREATE TABLE IF NOT EXISTS nutrition_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    meal_type TEXT NOT NULL CHECK (meal_type IN ('breakfast', 'lunch', 'dinner', 'snack')),
    title TEXT NOT NULL,
    calories INTEGER NOT NULL,
    carbs DECIMAL(10, 2),
    protein DECIMAL(10, 2),
    fat DECIMAL(10, 2),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ nutrition_entries
CREATE INDEX IF NOT EXISTS nutrition_entries_user_id_idx ON nutrition_entries(user_id);
CREATE INDEX IF NOT EXISTS nutrition_entries_date_idx ON nutrition_entries(date);
CREATE INDEX IF NOT EXISTS nutrition_entries_user_date_idx ON nutrition_entries(user_id, date);

-- Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±Ğ»ÑĞ´
CREATE TABLE IF NOT EXISTS favorite_meals (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    calories INTEGER NOT NULL,
    carbs DECIMAL(10, 2),
    protein DECIMAL(10, 2),
    fat DECIMAL(10, 2),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ favorite_meals
CREATE INDEX IF NOT EXISTS favorite_meals_user_id_idx ON favorite_meals(user_id);

-- ============================================================================
-- âœ… ĞœĞ˜Ğ“Ğ ĞĞ¦Ğ˜Ğ˜ ĞŸĞ Ğ˜ĞœĞ•ĞĞ•ĞĞ«
-- ============================================================================
-- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹:
-- SELECT table_name FROM information_schema.tables 
-- WHERE table_schema = 'public' 
-- AND table_name IN ('nutrition_entries', 'favorite_meals');

