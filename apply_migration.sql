-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- üöÄ –ú–ò–ì–†–ê–¶–ò–Ø –ë–î: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users –ø–æ–ª—è–º–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-- 
-- üìã –û–ø–∏—Å–∞–Ω–∏–µ:
--    –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
--    –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü—É users
--
-- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
--    ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç IF NOT EXISTS - –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
--    ‚Ä¢ –ù–µ —É–¥–∞–ª—è–µ—Ç –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
--    ‚Ä¢ –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
--
-- üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é:
--    1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
--    2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —ç—Ç–æ—Ç —Ñ–∞–π–ª (Ctrl+A / Cmd+A)
--    3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor (Ctrl+V / Cmd+V)
--    4. –ù–∞–∂–º–∏—Ç–µ Run (–∏–ª–∏ Ctrl+Enter / Cmd+Enter)
--
-- ‚ö° –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ü–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Å–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –≤ —Ç–∞–±–ª–∏—Ü—É users
-- –í—Å–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

DO $$ 
BEGIN
    -- –¢–∏–ø –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'auth_type') THEN
        ALTER TABLE users ADD COLUMN auth_type TEXT DEFAULT 'anonymous';
    END IF;

    -- –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'is_active') THEN
        ALTER TABLE users ADD COLUMN is_active BOOLEAN DEFAULT true;
    END IF;

    -- Coach style (–ª–∏—á–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'coach_style') THEN
        ALTER TABLE users ADD COLUMN coach_style TEXT;
    END IF;

    -- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'date_of_birth') THEN
        ALTER TABLE users ADD COLUMN date_of_birth DATE;
    END IF;

    -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'name') THEN
        ALTER TABLE users ADD COLUMN name TEXT;
    END IF;

    -- –ü–æ–ª
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'gender') THEN
        ALTER TABLE users ADD COLUMN gender TEXT;
    END IF;

    -- –£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'level') THEN
        ALTER TABLE users ADD COLUMN level TEXT;
    END IF;

    -- –¶–µ–ª–∏ (–º–∞—Å—Å–∏–≤)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'goals') THEN
        ALTER TABLE users ADD COLUMN goals TEXT[] DEFAULT '{}';
    END IF;

    -- –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'goal') THEN
        ALTER TABLE users ADD COLUMN goal TEXT;
    END IF;

    -- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'special_programs') THEN
        ALTER TABLE users ADD COLUMN special_programs TEXT[] DEFAULT '{}';
    END IF;

    -- –î–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'training_days_per_week') THEN
        ALTER TABLE users ADD COLUMN training_days_per_week INTEGER;
    END IF;

    -- –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'training_environment') THEN
        ALTER TABLE users ADD COLUMN training_environment TEXT;
    END IF;

    -- –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (–º–∞—Å—Å–∏–≤ slug-–æ–≤)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'equipment_items') THEN
        ALTER TABLE users ADD COLUMN equipment_items TEXT[] DEFAULT '{}';
    END IF;

    -- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'preferred_equipment') THEN
        ALTER TABLE users ADD COLUMN preferred_equipment TEXT[] DEFAULT '{}';
    END IF;

    -- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'preferred_muscles') THEN
        ALTER TABLE users ADD COLUMN preferred_muscles TEXT[] DEFAULT '{}';
    END IF;

    -- –†–æ—Å—Ç –≤ —Å–º
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'height_cm') THEN
        ALTER TABLE users ADD COLUMN height_cm INTEGER;
    END IF;

    -- –í–µ—Å –≤ –∫–≥
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'weight_kg') THEN
        ALTER TABLE users ADD COLUMN weight_kg DECIMAL(10, 2);
    END IF;

    -- –Ø–∑—ã–∫
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'language') THEN
        ALTER TABLE users ADD COLUMN language TEXT;
    END IF;

    -- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (JSONB)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'restrictions') THEN
        ALTER TABLE users ADD COLUMN restrictions JSONB DEFAULT '{}'::jsonb;
    END IF;

    -- –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è (JSONB)
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'contraindications') THEN
        ALTER TABLE users ADD COLUMN contraindications JSONB DEFAULT '{}'::jsonb;
    END IF;

    -- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'notifications_enabled') THEN
        ALTER TABLE users ADD COLUMN notifications_enabled BOOLEAN DEFAULT false;
    END IF;

    -- –ü–∏—Ç–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'nutrition_enabled') THEN
        ALTER TABLE users ADD COLUMN nutrition_enabled BOOLEAN DEFAULT false;
    END IF;

    -- –¢–µ–∫—É—â–∏–π —à–∞–≥ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns 
                   WHERE table_name = 'users' AND column_name = 'current_step') THEN
        ALTER TABLE users ADD COLUMN current_step INTEGER;
    END IF;
END $$;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
SELECT 
    column_name, 
    data_type,
    is_nullable
FROM information_schema.columns
WHERE table_name = 'users'
    AND column_name IN (
        'auth_type', 'is_active', 'coach_style', 'date_of_birth', 'name', 'gender', 'level', 'goal',
        'goals', 'special_programs', 'training_days_per_week', 'training_environment',
        'equipment_items', 'preferred_equipment', 'preferred_muscles',
        'height_cm', 'weight_kg', 'language', 'restrictions', 'contraindications',
        'notifications_enabled', 'nutrition_enabled', 'current_step'
    )
ORDER BY column_name;
