# Схема базы данных RYTM0X

Этот документ описывает структуру базы данных проекта RYTM0X. SQL определения находятся в файле `supabase/schema.sql`.

## Таблицы

### users

Таблица пользователей приложения.

| Поле | Тип | Описание |
|------|-----|----------|
| id | uuid | Уникальный идентификатор пользователя (первичный ключ) |
| email | text | Email пользователя (уникальный) |
| password_hash | text | Хеш пароля пользователя |
| created_at | timestamp | Дата и время создания записи |
| updated_at | timestamp | Дата и время последнего обновления записи |
| profile_data | jsonb | Дополнительные данные профиля (рост, вес, цели и т.д.) |

**Индексы:**
- `users_email_key` - уникальный индекс на поле email

---

### exercises

Таблица упражнений.

| Поле | Тип | Описание |
|------|-----|----------|
| id | uuid | Уникальный идентификатор упражнения (первичный ключ) |
| name | text | Название упражнения |
| description | text | Описание упражнения |
| muscle_groups | text[] | Массив групп мышц, задействованных в упражнении |
| equipment | text | Необходимое оборудование |
| created_at | timestamp | Дата и время создания записи |

---

### workouts

Таблица тренировок пользователей.

| Поле | Тип | Описание |
|------|-----|----------|
| id | uuid | Уникальный идентификатор тренировки (первичный ключ) |
| user_id | uuid | Идентификатор пользователя (внешний ключ -> users.id) |
| name | text | Название тренировки |
| date | date | Дата проведения тренировки |
| notes | text | Заметки к тренировке |
| created_at | timestamp | Дата и время создания записи |

**Связи:**
- `workouts_user_id_fkey` - внешний ключ на таблицу users

---

### workout_exercises

Связующая таблица между тренировками и упражнениями. Содержит детали выполнения упражнения в рамках конкретной тренировки.

| Поле | Тип | Описание |
|------|-----|----------|
| id | uuid | Уникальный идентификатор записи (первичный ключ) |
| workout_id | uuid | Идентификатор тренировки (внешний ключ -> workouts.id) |
| exercise_id | uuid | Идентификатор упражнения (внешний ключ -> exercises.id) |
| sets | integer | Количество подходов |
| reps | integer | Количество повторений |
| weight | decimal | Вес (в кг) |
| rest_seconds | integer | Время отдыха между подходами (в секундах) |
| order_index | integer | Порядковый номер упражнения в тренировке |

**Связи:**
- `workout_exercises_workout_id_fkey` - внешний ключ на таблицу workouts
- `workout_exercises_exercise_id_fkey` - внешний ключ на таблицу exercises

---

### ai_logs

Таблица логов запросов к AI сервисам.

| Поле | Тип | Описание |
|------|-----|----------|
| id | uuid | Уникальный идентификатор записи (первичный ключ) |
| user_id | uuid | Идентификатор пользователя (внешний ключ -> users.id) |
| request_type | text | Тип запроса: 'workout', 'nutrition', 'form_check' |
| request_data | jsonb | Данные запроса к AI |
| response_data | jsonb | Данные ответа от AI |
| created_at | timestamp | Дата и время создания записи |

**Связи:**
- `ai_logs_user_id_fkey` - внешний ключ на таблицу users

---

## Правила работы со схемой

1. **Источник истины:** SQL определения находятся в `supabase/schema.sql`
2. **Нельзя:** удалять таблицы, удалять колонки, изменять типы полей
3. **Можно:** добавлять новые поля и таблицы после обновления обоих файлов (schema.sql и db-schema.md)
4. **Изменения:** все изменения схемы должны быть отражены в обоих файлах перед применением в Supabase

